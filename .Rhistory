plot(est.110)
plot(est.110$geometry)
est.110<- est.l1[1:100,]
plot(est.110$geometry)
View(est.110)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn
tail(jul.jn)
jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y=="0")
jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15" & hour=="6")
plot(est.l1)
jul.jn
View(jul.jn)
head(jul.jn)
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
plot(jul.jn)
linea1.1
st_buffer<-sf::st_buffer(linea1.1, 100)
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- sf::st_within(est.l1, st_buffer)
st_buffer
plot(st_buffer)
st_within<- sf::st_within(est.l1, st_buffer)
st_within<- sf::st_within(est.l1, st_buffer, sparse = FALSE)
jul.jn
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
st_buffer<-sf::st_buffer(linea1.1, 100)
jul.jn <- cbind(jul.jn, st_within)
head(jul.jn)
jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
View(jul.jn)
linea1.1<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408))), crs = 4326))
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- as.data.frame(sf::st_within(jul.jn, st_buffer, sparse = FALSE))
View(st_within)
lineas.metrobus <- sf::st_read("D:/Escritorio/lineas.metrobus/lineas-metrobus.shp")
lineas.metrobus = lineas.metrobus %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408))), crs = 4326))
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- as.data.frame(sf::st_within(jul.jn, st_buffer, sparse = FALSE))
jul.jn <- cbind(jul.jn, st_within)
View(jul.jn)
View(jul.jn)
plot(st_buffer)
lineas.metrobus <- sf::st_read("D:/Escritorio/lineas.metrobus/lineas-metrobus.shp")
lineas.metrobus = lineas.metrobus %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
#Leer datos de julio
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
#Seleccionar solamente las columnas que me sirven
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
#Cambiar nombres de las variables
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
#Formato a las variables. Comencemos por vehicle, ya que la de timestamp se queda igual. Revisar que las variables hayan quedado como quiero.
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1 <- sf::st_read("D:/Escritorio/gtfs_estatico/linea1.1.shp")
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- as.data.frame(sf::st_within(jul.jn, st_buffer, sparse = FALSE))
jul.jn <- cbind(jul.jn, st_within)
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
lineas.metrobus <- sf::st_read("D:/Escritorio/lineas.metrobus/lineas-metrobus.shp")
lineas.metrobus = lineas.metrobus %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
#Leer datos de julio
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
#Seleccionar solamente las columnas que me sirven
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
#Cambiar nombres de las variables
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
#Formato a las variables. Comencemos por vehicle, ya que la de timestamp se queda igual. Revisar que las variables hayan quedado como quiero.
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
#Union de la base jul.jn con las líneas de Metrobus. Desde aquí vamos preparando el código para quedarnos con la línea 1.
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
#
est.l1 <- sf::st_join(jul.jn, lineas.metrobus, join = sf::st_nearest_feature, left = T)
est.l1$l.mbus <- substr(est.l1$name, 1, 4)
est.l1<- est.l1 %>% select(timestamp, vehicle, cst6cdt, name, nombre, geometry, l.mbus) %>% filter(l.mbus=="MB01")
#Objeto de clase sf
linea1.1 <- sf::st_read("D:/Escritorio/gtfs_estatico/linea1.1.shp")
#linea1.1<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408))), crs = 4326))
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
jul.jn <- cbind(jul.jn, st_within)
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
lineas.metrobus <- sf::st_read("D:/Escritorio/lineas.metrobus/lineas-metrobus.shp")
lineas.metrobus = lineas.metrobus %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
jul.jn2 <- jul.jn
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
jul.jn <- jul.jn2
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn2
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1 <- sf::st_read("D:/Escritorio/gtfs_estatico/linea1.1.shp")
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
st_within<- sf::st_within(jul.jn, st_buffer)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15" & hour=="6")
jul.jn <- jul.jn2
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15" & hour=="6")
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1 <- sf::st_read("D:/Escritorio/gtfs_estatico/linea1.1.shp")
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
jul.jn <- cbind(jul.jn, st_within)
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
plot(jul.jn)
plot(jul.jn$geometry)
jul.jn <- jul.jn2
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP,LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(day=="15")
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
plot(jul.jn$geometry)
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
View(st_within)
jul.jn <- cbind(jul.jn, st_within)
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
View(jul.jn)
plot(jul.jn)
plot(jul.jn$geometry)
unique(jul.jn$vehicle)
l1.mbus.est <- sf::st_read("D:/Escritorio/gtfs_estatico/l1.mbus.est03.shp")
l1.mbus.est <- sf::st_join(jul.jn, l1.mbus.est, join=sf::st_nearest_feature, left= T)
l1.mbus.est
l1.mbus.est = l1.mbus.est %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
l1.mbus.est <- sf::st_join(jul.jn, l1.mbus.est, join=sf::st_nearest_feature, left= T)
View(l1.mbus.est)
View(jul.jn)
View(jul.jn)
View(l1.mbus.est)
table(l1.mbus.est$vehicle, l1.mbus.est$hour)
unique(jul.jn$hour)
X1s <- c(0,3,5,8,10)
Y1s <- c(0,3,4,8,10)
Coord1 <- cbind(X1s,Y1s)
L1 <- st_linestring(Coord1)
L1 <- sf::st_linestring(Coord1)
plot(L1)
X2s <- c(2,1,1)
Y2s <- c(2,4,5)
Coord2 <- cbind(X2s,Y2s)
L2 <- st_linestring(Coord2)
L2 <- sf::st_linestring(Coord2)
X3s <- c(8,8)
Y3s <- c(8,5)
Coord3 <- cbind(X3s,Y3s)
# Crea objeto de Clase Linestring
L3 <- st_linestring(Coord3)
L3 <- sf::st_linestring(Coord3)
L1L2 <- st_multilinestring(list(L1,L2))
L1L2 <- sf::st_multilinestring(list(L1,L2))
L1L2 <- sf::st_multilinestring(list(L1,geometria2 <- st_sfc(L1,L2,L3)
L2))
L1L2 <- sf::st_multilinestring(list(L1,L2))
geometria2 <- st_sfc(L1,L2,L3)
geometria2 <- sf::st_sfc(L1,L2,L3)
plot(geometria2)
plot(st_buffer)
View(l1.mbus.est)
table(l1.mbus.est$nombre, l1.mbus.est$hour)
lineas.metrobus <- sf::st_read("D:/Escritorio/lineas.metrobus/lineas-metrobus.shp")
lineas.metrobus = lineas.metrobus %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
names(jul.jn)
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP, SPEED, LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "speed", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(day=="15")
names(jul.jn)
View(jul.jn)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
names(jul.jn)
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP, SPEED, LECTURA, geometry)
head(jul.jn)
tail(jul.jn)
jul.jn$SPEED
summarise(jul.jn$SPEED)
summary(jul.jn$SPEED)
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
head(jul.jn)
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP, ODOMETER, LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "speed", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- read.csv("D:/Escritorio/gtfs.metrobus/jul/jul.jn.csv")
jul.jn2 <- jul.jn
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP, ODOMETER, LECTURA, geometry)
names(jul.jn) <- c("timestamp", "vehicle", "speed", "x", "y")
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(day=="15")
mean(jul.jn$speed)
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(speed!="0")
mean(jul.jn$speed)
range(jul.jn$speed)
summary(jul.jn$speed)
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408))), crs = 4326))
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
jul.jn <- cbind(jul.jn, st_within)
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
l1.mbus.est <- sf::st_read("D:/Escritorio/gtfs_estatico/l1.mbus.est03.shp")
l1.mbus.est = l1.mbus.est %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
l1.mbus.est <- sf::st_join(jul.jn, l1.mbus.est, join=sf::st_nearest_feature, left= T)
jul.jn
jul.jn <- jul.jn2
#Seleccionar solamente las columnas que me sirven
jul.jn <-  jul.jn %>% select(Id, TIMESTAMP, ODOMETER, LECTURA, geometry)
#Cambiar nombres de las variables
names(jul.jn) <- c("timestamp", "vehicle", "speed", "x", "y")
#Formato a las variables. Comencemos por vehicle, ya que la de timestamp se queda igual. Revisar que las variables hayan quedado como quiero.
jul.jn$vehicle <- substr(jul.jn$vehicle, 4, 100000)
jul.jn$vehicle <- as.factor(jul.jn$vehicle)
jul.jn$x <- chartr("c(", "  ", jul.jn$x)
jul.jn$x <- as.numeric(jul.jn$x)
jul.jn$y <- chartr(")", " ", jul.jn$y)
jul.jn$y <- as.numeric(jul.jn$y)
jul.jn$cst6cdt<- lubridate::as_datetime(jul.jn$timestamp, tz="CST6CDT")
jul.jn$day <- lubridate::day(jul.jn$cst6cdt)
jul.jn$hour <- lubridate::hour(jul.jn$cst6cdt)
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(y!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(x!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(speed!="0")
jul.jn <- jul.jn %>% select(timestamp, vehicle, speed, x, y, cst6cdt, day, hour) %>% filter(day=="15")
#Union de la base jul.jn con las líneas de Metrobus. Desde aquí vamos preparando el código para quedarnos con la línea 1.
jul.jn <- sf::st_as_sf(jul.jn, coords = c("x", "y"), crs = 4326, agr = "constant") #Convertir la base jul.jn en una con campo geométrico.
jul.jn <- jul.jn %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
#
est.l1 <- sf::st_join(jul.jn, lineas.metrobus, join = sf::st_nearest_feature, left = T)
est.l1$l.mbus <- substr(est.l1$name, 1, 4)
est.l1<- est.l1 %>% select(timestamp, vehicle, speed, cst6cdt, name, nombre, geometry, l.mbus) %>% filter(l.mbus=="MB01")
#Objeto de clase sf
linea1.1 <- sf::st_read("D:/Escritorio/gtfs_estatico/linea1.1.shp")
linea1.1<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408))), crs = 4326))
linea1.1 = linea1.1 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
st_buffer<-sf::st_buffer(linea1.1, 100)
st_within<- sf::st_within(jul.jn, st_buffer, sparse = FALSE)
jul.jn <- cbind(jul.jn, st_within)
jul.jn<- jul.jn %>% select(timestamp, vehicle, cst6cdt, speed, day, hour, st_within, geometry) %>% filter(st_within=="TRUE")
l1.mbus.est <- sf::st_read("D:/Escritorio/gtfs_estatico/l1.mbus.est03.shp")
l1.mbus.est = l1.mbus.est %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
#Unir
l1.mbus.est <- sf::st_join(jul.jn, l1.mbus.est, join=sf::st_nearest_feature, left= T)
jul.jn
mean(jul.jn$speed)
summary(jul.jn$speed)
boxplot(jul.jn$speed)
table(jul.jn$hour, jul.jn$speed)
plot(jul.jn$speed)
plot(jul.jn$hour, jul.jn$speed)
hist(jul.jn$speed)
hist(jul.jn$speed, breaks = "Sturges")
hist(jul.jn$speed, col = "steelblue", frame = FALSE))
hist(jul.jn$speed, col = "steelblue", frame = FALSE)
summary(jul.jn$speed)
summary(jul.jn$speed)
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512)))))
plot(linea1.2)
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583)))))
plot(linea1.2)
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619)))))
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826)))))
plot(linea1.2)
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326))))
plot(linea1.2)
linea1.1.2 <- st_multilinestring(list(llinea1.1,linea1.2))
linea1.1.2 <- sf::st_multilinestring(list(llinea1.1,linea1.2))
linea1.1.2 <- sf::st_multilinestring(list(linea1.1,linea1.2))
linea1.1.2 <- sf::st_multilinestring(list(linea1.1,linea1.2))
linea1.1.2 <- sf::st_multilinestring(linea1.1,linea1.2)
plot(linea1.1.2)
plot(linea1.1)
plot(linea1.1.2)
linea1.1.2
plot(linea1.1)
plot(linea1.2)
plot(linea1.1.2)
linea1.1.2 <- sf::st_multilinestring(linea1.1,linea1.2)
linea1.1.2
linea1.2
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326))))
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.2 <-sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326)
linea1.2 <-sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326))
linea1.2 <-sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326))
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.2 <-sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326))
plot(linea1.2)
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326))))
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.2
linea1.2 <- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855), crs = 4326)))
linea1.2<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855))), crs = 4326))
linea1.2<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855))), crs = 4326))
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
plot(linea1.2)
linea1.1.2 <- sf::st_multilinestring(linea1.1,linea1.2)
plot(linea1.1.2)
linea1.1.2 <- sf::st_multilinestring(list(linea1.1,linea1.2))
linea1.1.2 <- sf::st_multilinestring(list(linea1.1,linea1.2))
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
plot(linea1.2)
linea1.2<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855))), crs = 4326))
linea1.2 = linea1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
plot(linea1.2)
sf::st_multilinestring(list(linea1.1, linea1.2))
linea1.1
linea1.2
sf::st_sfc(linea1.1, linea1.2)
linea1.1<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408))), crs = 4326))
linea1.2<- sf::st_wrap_dateline(sf::st_sfc(sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855))), crs = 4326))
sf::st_multilinestring(linea1.1, linea1.2)
sf::st_multilinestring(list(linea1.1, linea1.2))
linea1.1.2 <- sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855))), crs = 4326)
linea1.2 <- sf::st_linestring(rbind(c(-99.1879, 19.3468), c(-99.1862, 19.3512), c(-99.1852, 19.3547), c(-99.1840, 19.3583), c(-99.1827, 19.3619), c(-99.1817, 19.3650), c(-99.1804, 19.3690), c(-99.1787, 19.3742), c(-99.1772, 19.3793), c(-99.1760, 19.3826), c(-99.1752, 19.3855)))
linea1.1 <- sf::st_linestring(rbind(c(-99.1691, 19.2793),c(-99.1700, 19.2803), c(-99.1755, 19.2837), c(-99.1744, 19.2883), c(-99.1773, 19.2925), c(-99.1812, 19.2941), c(-99.1855, 19.2994), c(-99.1860, 19.3044), c(-99.1874, 19.3146), c(-99.1884, 19.3227), c(-99.1899, 19.3408)))
sf::st_sfc(linea1.1, linea1.2)
linea1.1.2<- sf::st_sfc(linea1.1, linea1.2)
plot(linea1.1.2)
sf::st_sfc(linea1.1.2<- sf::st_sfc(linea1.1, linea1.2)
linea1.1.2<- sf::st_sfc(linea1.1, linea1.2)
dfafa
linea1.1.2 = linea1.1.2 %>% sf::st_set_crs(4326) %>% sf::st_transform(32214)
linea1.1.2
